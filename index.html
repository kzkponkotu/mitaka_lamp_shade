<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>        
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="jquery/jquery-1.9.1.js?0.5.2"></script>
        <script src="jquery/jquery.hammer.js?0.5.2"></script>
        <script src="lightgl.js"></script>
        <script src="csg.js?0.5.2"></script>
        <script src="formats.js?0.5.2"></script>
        <script src="openjscad.js?0.5.2"></script>
        <script src="openscad.js?0.5.2"></script>
        <script src="js/jscad-worker.js?0.5.2" charset="utf-8"></script>
        <script src="js/jscad-function.js?0.5.2" charset="utf-8"></script>
        <style>
            #viewerContext {
                width: 50vw;
                height: 80vh;                
            }
            .viewer canvas {
                width: 100%;
                height: 100%;  
            }
            body {
                background-color: #FFFFFF;
                margin-left: 0px;
                margin-top: 0px;
                margin-right: 0px;
                margin-bottom: 0px;
                overflow-x: hidden;
                overflow-y: hidden;
            }
        </style>
        <script>
            kesuzo = function kesu(){
                document.getElementsByName("kabe1")[0].style.display = "none";
                document.getElementsByName("kabe2")[0].style.display = "none";
                document.getElementsByName("kabe3")[0].style.display = "none";
                document.getElementsByName("kabe4")[0].style.display = "none";
                document.getElementsByClassName("parameterstable")[0].style.display = "none";
                document.getElementById("instantUpdate").style.display = "none";
                document.getElementById("statusspan").style.display = "none";
                document.getElementById("statusbuttons").children[1].style.display = "none";
            }

            setInterval(kesuzo,0);
        </script>
    </head>
    <body onload="loadProcessor()">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.min.js"></script>
        <script>
            function setup() {
                document.getElementById("instantUpdateLabel").style.display = "none";                
                onazika_douka="0";
                kesuka_douka=false;
                createCanvas(windowWidth/2, windowHeight);
                document.getElementById("defaultCanvas0").setAttribute('class','pull-right');
                smooth();
                bunkatu_window = new four_window();
                bunkatusuu = 10;
                gamen1_click = [];
                gamen2_click = [];
                gamen3_click = [];
                gamen4_click = [];
                for(y=0; y<bunkatusuu; y++){
                    gamen1_click[y] = [];
                    gamen2_click[y] = [];
                    gamen3_click[y] = [];
                    gamen4_click[y] = [];                                        
                    for(x=0; x<bunkatusuu; x++){
                        gamen1_click[y][x] = 0;
                        gamen2_click[y][x] = 0;
                        gamen3_click[y][x] = 0;
                        gamen4_click[y][x] = 0;
                    }
                }
            }

            function windowResized() {
                resizeCanvas(windowWidth/2, windowHeight);
            }

            function draw() {
                background(255);
                bunkatu_window.run(12,color(255,0,0));
                strokeWeight(2);
                stroke(0,0,255);
                noFill();
                for(y=0; y<bunkatusuu; y++){
                    for(x=0; x<bunkatusuu; x++){
                        if(gamen1_click[y][x]==0)noFill();
                        else fill(0,0,255);
                        rect(bunkatu_window.gamen1_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x,bunkatu_window.gamen1_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y,bunkatu_window.gamen_width/bunkatusuu,bunkatu_window.gamen_height/bunkatusuu);
                    }
                }
                for(y=0; y<bunkatusuu; y++){                
                    for(x=0; x<bunkatusuu; x++){
                        if(gamen2_click[y][x]==0)noFill();
                        else fill(0,0,255);                        
                        rect(bunkatu_window.gamen2_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x,bunkatu_window.gamen2_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y,bunkatu_window.gamen_width/bunkatusuu,bunkatu_window.gamen_height/bunkatusuu);
                    }
                }                
                for(y=0; y<bunkatusuu; y++){                
                    for(x=0; x<bunkatusuu; x++){
                        if(gamen3_click[y][x]==0)noFill();
                        else fill(0,0,255);                        
                        rect(bunkatu_window.gamen3_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x,bunkatu_window.gamen3_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y,bunkatu_window.gamen_width/bunkatusuu,bunkatu_window.gamen_height/bunkatusuu);
                    }
                }                
                for(y=0; y<bunkatusuu; y++){                
                    for(x=0; x<bunkatusuu; x++){
                        if(gamen4_click[y][x]==0)noFill();
                        else fill(0,0,255);                        
                        rect(bunkatu_window.gamen4_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x,bunkatu_window.gamen4_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y,bunkatu_window.gamen_width/bunkatusuu,bunkatu_window.gamen_height/bunkatusuu);
                    }
                }                    
                if(mouseIsPressed){
                    for(y=0; y<bunkatusuu; y++){
                        for(x=0; x<bunkatusuu; x++){
                            if(mouseX > bunkatu_window.gamen1_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen1_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                                if(mouseY > bunkatu_window.gamen1_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen1_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                    if(onazika_douka != str(1)+str(y)+str(x)){
                                        if(kesuka_douka)gamen1_click[y][x] = 0;
                                        else gamen1_click[y][x] = 1;
                                        onazika_douka = str(1)+str(y)+str(x);
                                    }
                                }
                            }

                            if(mouseX > bunkatu_window.gamen2_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen2_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                                if(mouseY > bunkatu_window.gamen2_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen2_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                    if(onazika_douka != str(2)+str(y)+str(x)){
                                        if(kesuka_douka)gamen2_click[y][x] = 0;
                                        else gamen2_click[y][x] = 1;
                                        onazika_douka = str(2)+str(y)+str(x);                                        
                                    }
                                }
                            }

                            if(mouseX > bunkatu_window.gamen3_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen3_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                                if(mouseY > bunkatu_window.gamen3_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen3_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                    if(onazika_douka != str(3)+str(y)+str(x)){                                    
                                        if(kesuka_douka)gamen3_click[y][x] = 0;
                                        else gamen3_click[y][x] = 1;
                                        onazika_douka = str(3)+str(y)+str(x);                                        
                                    }
                                }
                            }

                            if(mouseX > bunkatu_window.gamen4_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen4_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                                if(mouseY > bunkatu_window.gamen4_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen4_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                    if(onazika_douka != str(4)+str(y)+str(x)){
                                        if(kesuka_douka)gamen4_click[y][x] = 0;
                                        else gamen4_click[y][x] = 1;
                                        onazika_douka = str(4)+str(y)+str(x);                                        
                                    }
                                }
                            }
                        }
                    }
                }                            
            }

            function mousePressed() {
                rendou_string=""; 
                for(y=gamen1_click.length-1; y>=0; y--){
                    for(x=0; x<gamen1_click[y].length; x++){
                        rendou_string += str(1-gamen1_click[y][x]);
                    }
                }
                document.getElementsByName("kabe1")[0].value = rendou_string;

                rendou_string="";
                for(y=gamen2_click.length-1; y>=0; y--){
                    for(x=gamen2_click[y].length-1; x>=0; x--){
                        rendou_string += str(1-gamen2_click[y][x]);
                    }
                }
                document.getElementsByName("kabe2")[0].value = rendou_string;

                rendou_string="";
                for(y=gamen3_click.length-1; y>=0; y--){
                    for(x=gamen3_click[y].length-1; x>=0; x--){
                        rendou_string += str(1-gamen3_click[y][x]);
                    }
                }
                document.getElementsByName("kabe3")[0].value = rendou_string;

                rendou_string="";
                for(y=gamen4_click.length-1; y>=0; y--){
                    for(x=0; x<gamen4_click[y].length; x++){
                        rendou_string += str(1-gamen4_click[y][x]);
                    }
                }
                document.getElementsByName("kabe4")[0].value = rendou_string;

                for(y=0; y<bunkatusuu; y++){
                    for(x=0; x<bunkatusuu; x++){
                        if(mouseX > bunkatu_window.gamen1_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen1_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                            if(mouseY > bunkatu_window.gamen1_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen1_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                if(gamen1_click[y][x] == 0) kesuka_douka=false;
                                else kesuka_douka=true;
                            }
                        }

                        if(mouseX > bunkatu_window.gamen2_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen2_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                            if(mouseY > bunkatu_window.gamen2_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen2_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                if(gamen2_click[y][x] == 0) kesuka_douka=false;
                                else kesuka_douka=true;
                            }
                        }

                        if(mouseX > bunkatu_window.gamen3_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen3_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                            if(mouseY > bunkatu_window.gamen3_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen3_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                if(gamen3_click[y][x] == 0) kesuka_douka=false;
                                else kesuka_douka=true;
                            }
                        }

                        if(mouseX > bunkatu_window.gamen4_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x && mouseX < bunkatu_window.gamen4_hidariue_x + (bunkatu_window.gamen_width/bunkatusuu)*x + bunkatu_window.gamen_width/bunkatusuu){
                            if(mouseY > bunkatu_window.gamen4_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y && mouseY < bunkatu_window.gamen4_hidariue_y + (bunkatu_window.gamen_height/bunkatusuu)*y + bunkatu_window.gamen_height/bunkatusuu){
                                if(gamen4_click[y][x] == 0) kesuka_douka=false;
                                else kesuka_douka=true;
                            }
                        }

                    }
                }
            }

            function four_window() {
                sikiri_hutosa = 0;
                this.gamen1_hidariue_x = 0;
                this.gamen1_hidariue_y = 0;
                this.gamen2_hidariue_x = 0;
                this.gamen2_hidariue_y = 0;
                this.gamen3_hidariue_x = 0;
                this.gamen3_hidariue_y = 0;
                this.gamen4_hidariue_x = 0;
                this.gamen4_hidariue_y = 0;
                this.gamen_width = 0;
                this.gamen_height = 0;
                this.run = function(sikiri_hutosa,iro) {
                    stroke(iro);
                    strokeWeight(sikiri_hutosa);
                    this.gamen1_hidariue_x = width/2 + sikiri_hutosa/2;
                    this.gamen1_hidariue_y = sikiri_hutosa;
                    this.gamen2_hidariue_x = sikiri_hutosa;
                    this.gamen2_hidariue_y = sikiri_hutosa;
                    this.gamen3_hidariue_x = sikiri_hutosa;
                    this.gamen3_hidariue_y = height/2 + sikiri_hutosa/2;
                    this.gamen4_hidariue_x = width/2 + sikiri_hutosa/2;
                    this.gamen4_hidariue_y = height/2 + sikiri_hutosa/2;
                    this.gamen_width = width/2 - sikiri_hutosa*1.5;
                    this.gamen_height = height/2 - sikiri_hutosa*1.5;                
                    //外側の縦線
                    line(sikiri_hutosa/2,0,sikiri_hutosa/2,height);
                    line(width-(sikiri_hutosa/2),0,width-(sikiri_hutosa/2),height);                
                    //中央の十字
                    line(width/2,0,width/2,height);
                    line(0,height/2,width,height/2);                
                    //外側の横線
                    line(sikiri_hutosa/2,sikiri_hutosa/2,width,sikiri_hutosa/2);
                    line(sikiri_hutosa/2,height-sikiri_hutosa/2,width,height-sikiri_hutosa/2);                
                }
            }
        </script>        
        <!-- setup display of the errors as required by OpenJSCAD.js -->
        <div class="pull-left">
            <div id="header">
                <div id="errordiv">hello</div>
            </div>

            <!-- setup display of the viewer, i.e. canvas -->
            <div id="viewerContext"></div>

            <!-- setup display of the design parameters, as required by OpenJSCAD.js -->
            <!-- set display: block to display this -->
            <div id="parametersdiv" style="display: none;"></div>

            <!-- setup display of the status, as required by OpenJSCAD.js -->
            <!-- set display: block to display this -->
            <div id="tail">
                <div id="statusdiv"></div>
            </div>
        </div>

        <!-- define the design and the parameters -->
        <script type="text/javascript">
        var gProcessor = null;        // required by OpenJScad.org

        var gComponents = [ { file: 'ranpu_syeeedo.jscad' } ];

        function loadProcessor() {
            gProcessor = new OpenJsCad.Processor(document.getElementById("viewerContext"));
            loadJSCAD(0);
        }

        function loadJSCAD(choice) {
            var filepath = gComponents[choice].file;
            var xhr = new XMLHttpRequest();
            xhr.open("GET", filepath, true);
            gProcessor.setStatus("Loading "+filepath+" <img id=busy src='imgs/busy.gif'>");

            xhr.onload = function() {
            var source = this.responseText;
            //console.log(source);

            if(filepath.match(/\.jscad$/i)||filepath.match(/\.js$/i)) {
                gProcessor.setStatus("Processing "+filepath+" <img id=busy src='imgs/busy.gif'>");
                gProcessor.setJsCad(source,filepath);
            }
            }
            xhr.send();
        }
        </script>        
    </body>
</html>